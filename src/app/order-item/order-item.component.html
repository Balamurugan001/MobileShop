<div class="cart-container">
  <h2>{{"Order Details" | translate}}</h2>

  <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" multiTemplateDataRows>

    <!-- Name Column -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef> {{"Name" | translate}} </th>
      <td mat-cell *matCellDef="let item"> <strong>{{ item.name }}</strong> </td>
    </ng-container>

    <!-- Unit Price Column -->
    <ng-container matColumnDef="price">
      <th mat-header-cell *matHeaderCellDef> {{'Unit Price' | translate}} </th>
      <td mat-cell *matCellDef="let item"> {{ item.price | currency }} </td>
    </ng-container>

    <!-- Quantity Column -->
    <ng-container matColumnDef="quantity">
      <th mat-header-cell *matHeaderCellDef> {{"Quantity" | translate}} </th>
      <td mat-cell *matCellDef="let item"> {{ item.quantity }} </td>
    </ng-container>

    <!-- Item Price Column -->
    <ng-container matColumnDef="itemPrice">
      <th mat-header-cell *matHeaderCellDef> {{"Price" | translate}} </th>
      <td mat-cell *matCellDef="let item"> {{ item.quantity * item.price | currency }} </td>
    </ng-container>

    <!-- Rating Column -->
    <ng-container matColumnDef="rating">
      <th mat-header-cell *matHeaderCellDef> {{"Rating" | translate}} </th>
      <td mat-cell *matCellDef="let item">
        <ng-container *ngIf="status === 'Delivered'">
          <ng-container *ngIf="getRating(item.id)=== '0'; else ratingDisplay">
            <button mat-button *ngIf="auth=='user'" (click)="gotoFeedback(item.id)">{{"Rating"|translate}}</button>
          </ng-container>
        </ng-container>
        
        <ng-template #ratingDisplay>
          <div class="stars">
            <mat-icon
            *ngFor="let star of [].constructor(5); let i = index"
            [class.filled]="i < getRating(item.id)">
            {{ i < getRating(item.id) ? 'star' : 'star_border' }}
          </mat-icon>
          </div>
          
        </ng-template>
        
      </td>
    </ng-container>

    <!-- Feedback Column -->
    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let item" [attr.colspan]="displayedColumns.length" class="expand">
        <div [@detailExpand]="item === expandedElement ? 'expanded' : 'collapsed'" class="feedback-row">
          <p *ngIf="getFeedback(item.id) !== ''">Feedback: {{ getFeedback(item.id) }}</p>
          <p *ngIf="getFeedback(item.id) === ''">{{"Feedback isn't given" | translate}}</p>
        </div>
      </td>
    </ng-container>
    

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
        (click)="expandedElement = expandedElement === row ? null : row">
    </tr>
    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" 
        class="expanded-row" [@detailExpand]="row === expandedElement ? 'expanded' : 'collapsed'">
    </tr>
  </table>

  <div class="cart-total">
    <h3>Total:{{orderItem.price | currency}}</h3>
  </div>
</div>
